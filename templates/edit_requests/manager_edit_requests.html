{% extends 'base.html' %}

{% block title %}Pending Edit Requests - Agnivridhi CRM{% endblock %}

{% block sidebar %}
<nav class="col-md-3 col-lg-2 d-md-block sidebar">
    <div class="position-sticky pt-3">
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link" href="{% url 'accounts:manager_dashboard' %}">
                    <i class="bi bi-speedometer2"></i>Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'accounts:pending_approvals' %}">
                    <i class="bi bi-bell"></i>Pending Approvals
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" href="{% url 'edit_requests:manager_edit_requests' %}">
                    <i class="bi bi-pencil-square"></i>Edit Requests
                    {% if pending_count > 0 %}
                        <span class="badge bg-warning ms-2">{{ pending_count }}</span>
                    {% endif %}
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="{% url 'accounts:team_clients_list' %}">
                    <i class="bi bi-building"></i>Team Clients
                </a>
            </li>
        </ul>
    </div>
</nav>
{% endblock %}

{% block content %}
<h1 class="h2 mb-4">
    <i class="bi bi-pencil-square"></i> Pending Edit Requests
    <span class="badge bg-warning ms-2">{{ pending_count }}</span>
</h1>

{% if pending_count > 0 %}
<div class="alert alert-info">
    <i class="bi bi-info-circle"></i> <strong>{{ pending_count }}</strong> edit request{{ pending_count|pluralize }} from your team awaiting approval.
</div>

<div class="card">
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Client</th>
                        <th>Field to Edit</th>
                        <th>Current Value</th>
                        <th>Requested Value</th>
                        <th>Reason</th>
                        <th>Requested By</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in requests_with_details %}
                    <tr>
                        <td>
                            <a href="{% url 'clients:client_detail' item.client.id %}">
                                <strong>{{ item.client.company_name }}</strong>
                            </a>
                        </td>
                        <td><span class="badge bg-secondary">{{ item.edit_request.field_name }}</span></td>
                        <td>
                            <small class="text-muted">{{ item.edit_request.current_value|truncatewords:10 }}</small>
                        </td>
                        <td>
                            <strong class="text-primary">{{ item.edit_request.requested_value|truncatewords:10 }}</strong>
                        </td>
                        <td>
                            <small>{{ item.edit_request.reason|truncatewords:15 }}</small>
                        </td>
                        <td>{{ item.edit_request.requested_by.get_full_name|default:item.edit_request.requested_by.username }}</td>
                        <td>{{ item.edit_request.created_at|date:"M d, Y" }}</td>
                        <td>
                            <a href="{% url 'edit_requests:approve_edit_request' item.edit_request.id %}" 
                               class="btn btn-sm btn-success me-1" 
                               title="Approve and apply changes">
                                <i class="bi bi-check-circle"></i> Approve
                            </a>
                            <a href="{% url 'edit_requests:reject_edit_request' item.edit_request.id %}" 
                               class="btn btn-sm btn-danger" 
                               title="Reject this request">
                                <i class="bi bi-x-circle"></i> Reject
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% else %}
<div class="card text-center">
    <div class="card-body py-5">
        <i class="bi bi-check-circle text-success" style="font-size: 4rem;"></i>
        <h3 class="mt-3">No Pending Edit Requests</h3>
        <p class="text-muted">All edit requests from your team have been processed.</p>
        <a href="{% url 'accounts:manager_dashboard' %}" class="btn btn-primary mt-3">
            <i class="bi bi-speedometer2"></i> Back to Dashboard
        </a>
    </div>
</div>
{% endif %}
{% endblock %}
